<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Datos de Afiliaci√≥n - PRD Zacatecas</title>
    <link rel="stylesheet" href="../assets/css/styles.css">
</head>
<body>
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo"><img src="../assets/images/PRD.png" alt="PRD Logo"></div>
            <div class="sidebar-title">Revoluci√≥n Democr√°tica</div>
        </div>
        <div class="sidebar-menu">
            <a href="../index.html" class="menu-item"><span class="menu-icon">üè†</span><span class="menu-text">Inicio</span></a>
            <a href="paso-afiliacion.html" class="menu-item active"><span class="menu-icon">üìù</span><span class="menu-text">Af√≠liate</span></a>
        </div>
        <div class="sidebar-footer">PRD M√©xico 2025</div>
    </nav>
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <header class="header-container">
        <div class="page-wrapper header">
            <div class="logo"><a href="../index.html"><img src="../assets/images/PRD.png" alt="PRD Logo"></a></div>
            <div class="menu-btn" id="menuBtn">
                <div class="menu-line"></div><div class="menu-line"></div><div class="menu-line"></div>
            </div>
        </div>
    </header>

    <main class="form-page-main page-wrapper" id="mainContent">
        <div class="form-container">
            <div class="progress-container">
                <div class="progress-dots">
                    <div class="dot active"></div>
                    <div class="dot"></div>
                </div>
            </div>
            
            <div class="content">
                <h2 class="section-title">Formulario de Afiliaci√≥n Completo</h2>
                
                <!-- SECCI√ìN DEL RESPONSABLE -->
                <div class="affiliate-section">
                    <div class="affiliate-title">üë§ Responsable de afiliaci√≥n</div>
                    <div class="form-group">
                        <label class="form-label">Nombre del afiliador <span class="required">*</span></label>
                        <div class="input-wrapper">
                            <input type="text" id="afiliador" class="form-input" placeholder="Nombre completo del responsable" required>
                            <div class="validation-icon" id="afiliador-icon"></div>
                        </div>
                        <div class="error-message" id="afiliador-error"></div>
                    </div>
                </div>

                <!-- BOT√ìN ESCANEAR INE -->
                <div class="auth-options">
                    <button class="auth-btn ine-btn" onclick="scanINE()" type="button">üì∑ Escanear INE (Llena Todo Autom√°ticamente)</button>
                </div>

                <div class="divider">O INGRESA TUS DATOS MANUALMENTE</div>
                
                <form id="affiliationForm" novalidate>
                    <!-- SECCI√ìN 1: DATOS PERSONALES -->
                    <div class="form-section">
                        <h3 class="form-section-title">üë§ Informaci√≥n Personal</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Nombre(s) <span class="required">*</span></label>
                                <div class="input-wrapper">
                                    <input type="text" id="nombres" class="form-input" placeholder="Ej. Juan Carlos" required>
                                    <div class="validation-icon" id="nombres-icon"></div>
                                </div>
                                <div class="error-message" id="nombres-error"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Primer apellido <span class="required">*</span></label>
                                <div class="input-wrapper">
                                    <input type="text" id="primerApellido" class="form-input" placeholder="Ej. Hern√°ndez" required>
                                    <div class="validation-icon" id="primerApellido-icon"></div>
                                </div>
                                <div class="error-message" id="primerApellido-error"></div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Segundo apellido</label>
                            <div class="input-wrapper">
                                <input type="text" id="segundoApellido" class="form-input" placeholder="Ej. L√≥pez">
                                <div class="validation-icon" id="segundoApellido-icon"></div>
                            </div>
                            <div class="error-message" id="segundoApellido-error"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Lugar de nacimiento <span class="required">*</span></label>
                            <div class="input-wrapper">
                                <input type="text" id="lugarNacimiento" class="form-input" placeholder="Ej. Ciudad de M√©xico, CDMX" required>
                                <div class="validation-icon" id="lugarNacimiento-icon"></div>
                            </div>
                            <div class="error-message" id="lugarNacimiento-error"></div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">CURP <span class="required">*</span></label>
                                <div class="input-wrapper">
                                    <input type="text" id="curp" class="form-input" placeholder="18 caracteres" maxlength="18" required style="text-transform: uppercase;">
                                    <div class="validation-icon" id="curp-icon"></div>
                                </div>
                                <div class="error-message" id="curp-error"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Clave de elector <span class="required">*</span></label>
                                <div class="input-wrapper">
                                    <input type="text" id="claveElector" class="form-input" placeholder="18 caracteres" maxlength="18" required style="text-transform: uppercase;">
                                    <div class="validation-icon" id="claveElector-icon"></div>
                                </div>
                                <div class="error-message" id="claveElector-error"></div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Correo electr√≥nico <span class="required">*</span></label>
                                <div class="input-wrapper">
                                    <input type="email" id="email" class="form-input" placeholder="ejemplo@correo.com" required>
                                    <div class="validation-icon" id="email-icon"></div>
                                </div>
                                <div class="error-message" id="email-error"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">N√∫mero de tel√©fono <span class="required">*</span></label>
                                <div class="input-wrapper">
                                    <input type="tel" id="telefono" class="form-input" placeholder="10 d√≠gitos" maxlength="10" required>
                                    <div class="validation-icon" id="telefono-icon"></div>
                                </div>
                                <div class="error-message" id="telefono-error"></div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">G√©nero <span class="required">*</span></label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="gender" value="masculino" required>
                                    <span>Masculino</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="gender" value="femenino" required>
                                    <span>Femenino</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="gender" value="no_decir" required>
                                    <span>Prefiero no decirlo</span>
                                </label>
                            </div>
                            <div class="error-message" id="gender-error"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">¬øC√≥mo llegas al PRD? <span class="required">*</span></label>
                            <div class="input-wrapper">
                                <select id="llegadaPRD" class="form-select" required>
                                    <option value="">Selecciona una opci√≥n</option>
                                    <option value="simpatizante">Simpatizante</option>
                                    <option value="militante">Militante</option>
                                    <option value="cuadro">Cuadro</option>
                                </select>
                                <div class="validation-icon" id="llegadaPRD-icon"></div>
                            </div>
                            <div class="error-message" id="llegadaPRD-error"></div>
                        </div>
                    </div>

                    <!-- SECCI√ìN 2: DOMICILIO -->
                    <div class="form-section">
                        <h3 class="form-section-title">üè† Informaci√≥n de Domicilio</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Estado <span class="required">*</span></label>
                                <select class="form-select" id="estado" required>
                                    <option value="Zacatecas" selected>Zacatecas</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Municipio <span class="required">*</span></label>
                                <select class="form-select" id="municipio" required>
                                    <option value="" selected disabled>Selecciona un municipio</option>
                                    <option value="Apozol">Apozol</option>
                                    <option value="Apulco">Apulco</option>
                                    <option value="Atolinga">Atolinga</option>
                                    <option value="Benito Ju√°rez">Benito Ju√°rez</option>
                                    <option value="Calera">Calera</option>
                                    <option value="Ca√±itas de Felipe Pescador">Ca√±itas de Felipe Pescador</option>
                                    <option value="Concepci√≥n del Oro">Concepci√≥n del Oro</option>
                                    <option value="Cuauht√©moc">Cuauht√©moc</option>
                                    <option value="Chalchihuites">Chalchihuites</option>
                                    <option value="Fresnillo">Fresnillo</option>
                                    <option value="Trinidad Garc√≠a de la Cadena">Trinidad Garc√≠a de la Cadena</option>
                                    <option value="Genaro Codina">Genaro Codina</option>
                                    <option value="General Enrique Estrada">General Enrique Estrada</option>
                                    <option value="General Francisco R. Murgu√≠a">General Francisco R. Murgu√≠a</option>
                                    <option value="El Plateado de Joaqu√≠n Amaro">El Plateado de Joaqu√≠n Amaro</option>
                                    <option value="General P√°nfilo Natera">General P√°nfilo Natera</option>
                                    <option value="Guadalupe">Guadalupe</option>
                                    <option value="Huanusco">Huanusco</option>
                                    <option value="Jalpa">Jalpa</option>
                                    <option value="Jerez">Jerez</option>
                                    <option value="Jim√©nez del Teul">Jim√©nez del Teul</option>
                                    <option value="Juan Aldama">Juan Aldama</option>
                                    <option value="Juchipila">Juchipila</option>
                                    <option value="Loreto">Loreto</option>
                                    <option value="Luis Moya">Luis Moya</option>
                                    <option value="Mazapil">Mazapil</option>
                                    <option value="Melchor Ocampo">Melchor Ocampo</option>
                                    <option value="Mezquital del Oro">Mezquital del Oro</option>
                                    <option value="Miguel Auza">Miguel Auza</option>
                                    <option value="Momax">Momax</option>
                                    <option value="Monte Escobedo">Monte Escobedo</option>
                                    <option value="Morelos">Morelos</option>
                                    <option value="Moyahua de Estrada">Moyahua de Estrada</option>
                                    <option value="Nochistl√°n de Mej√≠a">Nochistl√°n de Mej√≠a</option>
                                    <option value="Noria de √Ångeles">Noria de √Ångeles</option>
                                    <option value="Ojocaliente">Ojocaliente</option>
                                    <option value="P√°nuco">P√°nuco</option>
                                    <option value="Pinos">Pinos</option>
                                    <option value="R√≠o Grande">R√≠o Grande</option>
                                    <option value="Sa√≠n Alto">Sa√≠n Alto</option>
                                    <option value="El Salvador">El Salvador</option>
                                    <option value="Santa Mar√≠a de la Paz">Santa Mar√≠a de la Paz</option>
                                    <option value="Sombrerete">Sombrerete</option>
                                    <option value="Susticac√°n">Susticac√°n</option>
                                    <option value="Tabasco">Tabasco</option>
                                    <option value="Tepechitl√°n">Tepechitl√°n</option>
                                    <option value="Tepetongo">Tepetongo</option>
                                    <option value="Te√∫l de Gonz√°lez Ortega">Te√∫l de Gonz√°lez Ortega</option>
                                    <option value="Tlaltenango de S√°nchez Rom√°n">Tlaltenango de S√°nchez Rom√°n</option>
                                    <option value="Valpara√≠so">Valpara√≠so</option>
                                    <option value="Vetagrande">Vetagrande</option>
                                    <option value="Villa de Cos">Villa de Cos</option>
                                    <option value="Villa Garc√≠a">Villa Garc√≠a</option>
                                    <option value="Villa Gonz√°lez Ortega">Villa Gonz√°lez Ortega</option>
                                    <option value="Villa Hidalgo">Villa Hidalgo</option>
                                    <option value="Villanueva">Villanueva</option>
                                    <option value="Zacatecas">Zacatecas</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Colonia <span class="required">*</span></label>
                                <input type="text" id="colonia" class="form-input" placeholder="Ej. Centro" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">C√≥digo postal <span class="required">*</span></label>
                                <input type="tel" id="codigoPostal" class="form-input" placeholder="5 d√≠gitos" maxlength="5" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Calle <span class="required">*</span></label>
                            <input type="text" id="calle" class="form-input" placeholder="Ej. Av. Revoluci√≥n" required>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">N√∫mero Exterior</label>
                                <input type="text" id="numeroExterior" class="form-input" placeholder="Ej. 123">
                            </div>
                            <div class="form-group">
                                <label class="form-label">N√∫mero Interior</label>
                                <input type="text" id="numeroInterior" class="form-input" placeholder="Ej. A">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            
            <div class="footer-nav">
                <a href="../index.html" class="back-link">Cancelar</a>
                <button class="next-button" onclick="nextStep()">Continuar a T√©rminos ‚Üí</button>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-text">Partido de la Revoluci√≥n Democr√°tica</div>
    </footer>

    <script src="../assets/js/main.js"></script>

    <script>
        // C√ìDIGO JAVASCRIPT COMPLETO PARA MYSQL

        // Objeto de validaciones (combinado)
        const validators = {
            validateName: (value) => {
                const nameRegex = /^[a-zA-Z√Ä-√ø\u00f1\u00d1\s]{2,50}$/;
                if (!value.trim()) return 'Este campo es obligatorio';
                if (!nameRegex.test(value)) return 'Solo se permiten letras y espacios (2-50 caracteres)';
                return null;
            },
            validateCURP: (value) => {
                const curpRegex = /^[A-Z]{4}[0-9]{6}[HM][A-Z]{5}[0-9A-Z][0-9]$/;
                if (!value.trim()) return 'La CURP es obligatoria';
                if (value.length !== 18) return 'La CURP debe tener exactamente 18 caracteres';
                const upperValue = value.toUpperCase();
                if (!curpRegex.test(upperValue)) return 'Formato de CURP inv√°lido';
                return null;
            },
            validateClaveElector: (value) => {
                const claveRegex = /^[A-Z]{6}[0-9]{8}[HM][0-9]{3}$/;
                if (!value.trim()) return 'La clave de elector es obligatoria';
                if (value.length !== 18) return 'La clave de elector debe tener exactamente 18 caracteres';
                const upperValue = value.toUpperCase();
                if (!claveRegex.test(upperValue)) return 'Formato de clave de elector inv√°lido';
                return null;
            },
            validateEmail: (value) => {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!value.trim()) return 'El correo electr√≥nico es obligatorio';
                if (!emailRegex.test(value)) return 'Formato de correo electr√≥nico inv√°lido';
                return null;
            },
            validatePhone: (value) => {
                const phoneRegex = /^[0-9]{10}$/;
                if (!value.trim()) return 'El n√∫mero de tel√©fono es obligatorio';
                if (!phoneRegex.test(value)) return 'El tel√©fono debe tener exactamente 10 d√≠gitos';
                return null;
            },
            validatePlace: (value) => {
                const placeRegex = /^[a-zA-Z√Ä-√ø\u00f1\u00d1\s,.-]{5,100}$/;
                if (!value.trim()) return 'El lugar de nacimiento es obligatorio';
                if (!placeRegex.test(value)) return 'Formato de lugar inv√°lido (5-100 caracteres)';
                return null;
            },
            validateRequired: (value) => {
                if (!value.trim()) return 'Este campo es obligatorio';
                return null;
            }
        };

        // Funci√≥n para mostrar estado de validaci√≥n
        function showValidationState(fieldId, isValid, errorMessage = '') {
            const field = document.getElementById(fieldId);
            const icon = document.getElementById(fieldId + '-icon');
            const errorDiv = document.getElementById(fieldId + '-error');

            if (!field) return;

            field.classList.remove('is-valid', 'is-invalid');
            
            if (isValid) {
                field.classList.add('is-valid');
                if (icon) icon.style.color = '#28a745';
                if (errorDiv) errorDiv.classList.remove('show');
            } else {
                field.classList.add('is-invalid');
                if (icon) icon.style.color = '#dc3545';
                if (errorDiv) {
                    errorDiv.textContent = errorMessage;
                    errorDiv.classList.add('show');
                }
            }
        }

        // Funci√≥n para validar un campo individual
        function validateField(fieldId, validator) {
            const field = document.getElementById(fieldId);
            if (!field) return true;
            
            const value = field.value;
            const error = validator(value);
            
            showValidationState(fieldId, !error, error);
            return !error;
        }

        // Configurar validaciones en tiempo real
        function setupRealTimeValidations() {
            // Datos personales
            const personalFields = [
                ['afiliador', validators.validateRequired],
                ['nombres', validators.validateName],
                ['primerApellido', validators.validateName],
                ['lugarNacimiento', validators.validatePlace],
                ['curp', validators.validateCURP],
                ['claveElector', validators.validateClaveElector],
                ['email', validators.validateEmail],
                ['telefono', validators.validatePhone],
                ['llegadaPRD', validators.validateRequired]
            ];

            personalFields.forEach(([fieldId, validator]) => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('blur', () => {
                        validateField(fieldId, validator);
                    });
                }
            });

            // Segundo apellido (opcional)
            const segundoApellido = document.getElementById('segundoApellido');
            if (segundoApellido) {
                segundoApellido.addEventListener('blur', () => {
                    const value = segundoApellido.value;
                    if (value.trim()) {
                        validateField('segundoApellido', validators.validateName);
                    } else {
                        showValidationState('segundoApellido', true);
                    }
                });
            }

            // CURP y Clave de elector en may√∫sculas
            ['curp', 'claveElector'].forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('input', (e) => {
                        e.target.value = e.target.value.toUpperCase();
                    });
                }
            });

            // Tel√©fono y c√≥digo postal solo n√∫meros
            ['telefono', 'codigoPostal'].forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('input', (e) => {
                        e.target.value = e.target.value.replace(/[^0-9]/g, '');
                    });
                }
            });

            // Validaci√≥n en tiempo real para campos de domicilio
            const addressFields = ['municipio', 'colonia', 'codigoPostal', 'calle'];
            addressFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('blur', function() {
                        if (this.value.trim()) {
                            this.classList.remove('is-invalid');
                            this.classList.add('is-valid');
                        } else {
                            this.classList.remove('is-valid');
                            this.classList.add('is-invalid');
                        }
                    });
                }
            });
        }

        // Validar formulario completo
        function validateForm() {
            let isValid = true;
            
            // Validaciones de datos personales
            const personalValidations = [
                ['afiliador', validators.validateRequired],
                ['nombres', validators.validateName],
                ['primerApellido', validators.validateName],
                ['lugarNacimiento', validators.validatePlace],
                ['curp', validators.validateCURP],
                ['claveElector', validators.validateClaveElector],
                ['email', validators.validateEmail],
                ['telefono', validators.validatePhone],
                ['llegadaPRD', validators.validateRequired]
            ];

            personalValidations.forEach(([fieldId, validator]) => {
                if (!validateField(fieldId, validator)) {
                    isValid = false;
                }
            });

            // Validar segundo apellido si tiene valor
            const segundoApellido = document.getElementById('segundoApellido').value;
            if (segundoApellido.trim()) {
                if (!validateField('segundoApellido', validators.validateName)) {
                    isValid = false;
                }
            }

            // Validar g√©nero
            const genderRadios = document.querySelectorAll('input[name="gender"]');
            const genderSelected = Array.from(genderRadios).some(radio => radio.checked);
            const genderError = document.getElementById('gender-error');
            
            if (!genderSelected) {
                if (genderError) {
                    genderError.textContent = 'Debes seleccionar un g√©nero';
                    genderError.classList.add('show');
                }
                isValid = false;
            } else {
                if (genderError) genderError.classList.remove('show');
            }

            // Validar campos de domicilio
            const requiredAddressFields = ['municipio', 'colonia', 'codigoPostal', 'calle'];
            requiredAddressFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.classList.remove('is-invalid');
                    if (!field.value.trim()) {
                        field.classList.add('is-invalid');
                        isValid = false;
                    }
                }
            });

            return isValid;
        }

        // Funci√≥n para el siguiente paso (ACTUALIZADA PARA MYSQL)
        function nextStep() {
            if (validateForm()) {
                // Guardar todos los datos en localStorage
                const formFields = [
                    'afiliador', 'nombres', 'primerApellido', 'segundoApellido',
                    'lugarNacimiento', 'curp', 'claveElector', 'email', 'telefono',
                    'llegadaPRD', 'municipio', 'colonia', 'codigoPostal', 'calle',
                    'numeroExterior', 'numeroInterior'
                ];
                
                formFields.forEach(fieldId => {
                    const element = document.getElementById(fieldId);
                    if (element) {
                        localStorage.setItem(fieldId, element.value);
                    }
                });
                
                // Guardar g√©nero
                const genderRadio = document.querySelector('input[name="gender"]:checked');
                if (genderRadio) {
                    localStorage.setItem('genero', genderRadio.value);
                }
                
                // Guardar estado (siempre Zacatecas)
                localStorage.setItem('estado', 'Zacatecas');
                
                console.log('‚úÖ Datos guardados en localStorage para MySQL');
                
                // Mostrar datos guardados para debug
                console.log('Datos guardados:', {
                    afiliador: localStorage.getItem('afiliador'),
                    nombres: localStorage.getItem('nombres'),
                    primer_apellido: localStorage.getItem('primerApellido'),
                    curp: localStorage.getItem('curp'),
                    clave_elector: localStorage.getItem('claveElector'),
                    email: localStorage.getItem('email'),
                    municipio: localStorage.getItem('municipio')
                });
                
                // Redireccionar al paso 2
                window.location.href = "paso 2.html";
            } else {
                alert('‚ùå Por favor corrige los errores marcados en el formulario.');
                
                // Hacer scroll al primer campo con error
                const firstError = document.querySelector('.is-invalid');
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstError.focus();
                }
            }
        }

        // Funci√≥n para el escaneo de INE (ACTUALIZADA PARA MYSQL)
        function scanINE() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.capture = 'environment'; // Usar c√°mara trasera en m√≥viles
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                // Mostrar indicador de carga
                const originalText = document.querySelector('.ine-btn').textContent;
                document.querySelector('.ine-btn').textContent = 'üîÑ Procesando...';
                document.querySelector('.ine-btn').disabled = true;
                
                // Crear FormData y enviar
                const formData = new FormData();
                formData.append('imagen', file);
                
                fetch('/api/extract-ine-prd', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Respuesta del escaneo MySQL:', data);
                    
                    if (data.success) {
                        // Llenar autom√°ticamente los campos con los datos detectados
                        const datos = data.datos_prd;
                        
                        if (datos.curp !== 'NO DETECTADO') {
                            document.getElementById('curp').value = datos.curp;
                            validateField('curp', validators.validateCURP);
                        }
                        
                        if (datos.clave_elector !== 'NO DETECTADO') {
                            document.getElementById('claveElector').value = datos.clave_elector;
                            validateField('claveElector', validators.validateClaveElector);
                        }
                        
                        if (datos.nombres !== 'NO DETECTADO') {
                            document.getElementById('nombres').value = datos.nombres;
                            validateField('nombres', validators.validateName);
                        }
                        
                        if (datos.primer_apellido !== 'NO DETECTADO') {
                            document.getElementById('primerApellido').value = datos.primer_apellido;
                            validateField('primerApellido', validators.validateName);
                        }
                        
                        if (datos.segundo_apellido !== 'NO DETECTADO') {
                            document.getElementById('segundoApellido').value = datos.segundo_apellido;
                            validateField('segundoApellido', validators.validateName);
                        }
                        
                        if (datos.municipio !== 'NO DETECTADO') {
                            document.getElementById('municipio').value = datos.municipio;
                        }
                        
                        if (datos.codigo_postal !== 'NO DETECTADO') {
                            document.getElementById('codigoPostal').value = datos.codigo_postal;
                        }
                        
                        if (datos.calle !== 'NO DETECTADO') {
                            document.getElementById('calle').value = datos.calle;
                        }
                        
                        if (datos.colonia !== 'NO DETECTADO') {
                            document.getElementById('colonia').value = datos.colonia;
                        }
                        
                        // Establecer g√©nero si se detect√≥
                        if (datos.sexo !== 'NO DETECTADO') {
                            const genderRadio = document.querySelector(`input[name="gender"][value="${datos.sexo}"]`);
                            if (genderRadio) {
                                genderRadio.checked = true;
                            }
                        }
                        
                        // Mostrar mensaje de √©xito
                        const detectedFields = Object.entries(datos)
                            .filter(([key, value]) => value !== 'NO DETECTADO')
                            .map(([key]) => key);
                        
                        alert(`‚úÖ ¬°Escaneo exitoso con MySQL!\n\nCampos detectados: ${detectedFields.length}\n\nRevisa y completa los campos faltantes.`);
                        
                        // Guardar m√©todo de captura
                        localStorage.setItem('metodo_captura', 'ine_scan');
                        
                    } else {
                        alert(`‚ùå Error en el escaneo: ${data.error}\n\nPor favor llena el formulario manualmente.`);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('‚ùå Error de conexi√≥n con MySQL. Por favor llena el formulario manualmente.');
                })
                .finally(() => {
                    // Restaurar bot√≥n
                    document.querySelector('.ine-btn').textContent = originalText;
                    document.querySelector('.ine-btn').disabled = false;
                });
            };
            
            input.click();
        }

        // Inicializar validaciones al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            setupRealTimeValidations();
            
            // Agregar listener para el formulario
            const form = document.getElementById('affiliationForm');
            if (form) {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    nextStep();
                });
            }
        });

        // Funcionalidad del men√∫ lateral
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            const menuBtn = document.getElementById('menuBtn');
            
            if (sidebar) sidebar.classList.toggle('active');
            if (overlay) overlay.classList.toggle('active');
            if (menuBtn) menuBtn.classList.toggle('active');
        }

        // Inicializar eventos del men√∫
        document.addEventListener('DOMContentLoaded', function() {
            const menuBtn = document.getElementById('menuBtn');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (menuBtn) {
                menuBtn.addEventListener('click', toggleSidebar);
            }
            
            if (overlay) {
                overlay.addEventListener('click', toggleSidebar);
            }
        });
    </script>

    <style>
        /* Estilos adicionales para las secciones del formulario */
        .form-section {
            background: #ffffff;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .form-section-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #000;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid #FFD700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .affiliate-section {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .auth-options {
            margin: 30px 0;
            text-align: center;
        }

        .auth-btn {
            background: #FFD700;
            color: #000;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .auth-btn:hover {
            background: #ffca00;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .divider {
            text-align: center;
            margin: 30px 0;
            color: #999;
            font-size: 0.9rem;
            font-weight: 500;
            position: relative;
        }

        .divider::before,
        .divider::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 45%;
            height: 1px;
            background: #ddd;
        }

        .divider::before {
            left: 0;
        }

        .divider::after {
            right: 0;
        }

        /* Ajustes responsive */
        @media (max-width: 768px) {
            .form-section {
                padding: 20px;
                margin-bottom: 20px;
            }
            
            .form-section-title {
                font-size: 1.1rem;
            }
        }
    </style>
</body>
</html>